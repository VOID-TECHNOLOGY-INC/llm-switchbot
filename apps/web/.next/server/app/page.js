(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1651:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(267),s(2251),s(6340);var r=s(2562),n=s(8390),a=s(1408),l=s.n(a),i=s(367),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,267)),"/Volumes/SSD2TB_DATA/src/llm-switchbot/apps/web/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,2251)),"/Volumes/SSD2TB_DATA/src/llm-switchbot/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,6340,23)),"next/dist/client/components/not-found-error"]}],c=["/Volumes/SSD2TB_DATA/src/llm-switchbot/apps/web/src/app/page.tsx"],m="/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},6699:(e,t,s)=>{Promise.resolve().then(s.bind(s,5364))},6594:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6733,23)),Promise.resolve().then(s.t.bind(s,1298,23)),Promise.resolve().then(s.t.bind(s,7137,23)),Promise.resolve().then(s.t.bind(s,2644,23)),Promise.resolve().then(s.t.bind(s,3646,23)),Promise.resolve().then(s.t.bind(s,6660,23))},6324:()=>{},5364:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(4871),n=s(5647);let a=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V6.75a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 6.75v10.5a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h9v9h-9v-9Z"}))}),l=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}),i=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"}))}),o=function(){for(var e,t,s=0,r="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=function e(t){var s,r,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var a=t.length;for(s=0;s<a;s++)t[s]&&(r=e(t[s]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r)}return n}(e))&&(r&&(r+=" "),r+=t);return r};function d({messages:e,onSendMessage:t,isLoading:s=!1}){let[d,c]=(0,n.useState)(""),m=(0,n.useRef)(null),u=e=>{e.preventDefault();let r=d.trim();r&&!s&&(t(r),c(""))};return(0,r.jsxs)("div",{className:"flex flex-col h-full bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.map((e,t)=>(0,r.jsxs)("div",{className:o("flex gap-3","user"===e.role?"justify-end":"justify-start"),children:["assistant"===e.role&&r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center",children:r.jsx(a,{className:"w-5 h-5 text-white"})})}),(0,r.jsxs)("div",{className:o("max-w-xs lg:max-w-md px-4 py-2 rounded-lg","user"===e.role?"bg-primary-500 text-white":"bg-white text-gray-900 border"),children:[r.jsx("p",{className:"text-sm",children:e.content}),e.toolCalls&&e.toolCalls.length>0&&r.jsx("div",{className:"mt-2 text-xs opacity-75",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[r.jsx(a,{className:"w-3 h-3"}),r.jsx("span",{children:"デバイス操作を実行しました"})]})}),e.toolResults&&e.toolResults.length>0&&r.jsx("div",{className:"mt-3 text-sm",children:e.toolResults.map((e,t)=>(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded border",children:["get_devices"===e.tool_name&&e.result?.body&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"\uD83D\uDCF1 デバイス一覧"}),e.result.body.deviceList&&e.result.body.deviceList.length>0&&(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("h5",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDD0C 物理デバイス"}),r.jsx("ul",{className:"space-y-1",children:e.result.body.deviceList.map(e=>(0,r.jsxs)("li",{className:"text-sm",children:["• ",e.deviceName," (",e.deviceType,")"]},e.deviceId))})]}),e.result.body.infraredRemoteList&&e.result.body.infraredRemoteList.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCFA 赤外線リモート"}),r.jsx("ul",{className:"space-y-1",children:e.result.body.infraredRemoteList.map(e=>(0,r.jsxs)("li",{className:"text-sm",children:["• ",e.deviceName," (",e.remoteType,")"]},e.deviceId))})]})]}),"get_device_status"===e.tool_name&&e.result?.body&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"\uD83D\uDCCA デバイス状態"}),"MeterPlus"===e.result.body.deviceType&&(0,r.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-red-500",children:"\uD83C\uDF21️"}),r.jsx("span",{className:"font-medium",children:"温度:"}),(0,r.jsxs)("span",{className:"font-bold text-red-600",children:[e.result.body.temperature,"\xb0C"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-blue-500",children:"\uD83D\uDCA7"}),r.jsx("span",{className:"font-medium",children:"湿度:"}),(0,r.jsxs)("span",{className:"font-bold text-blue-600",children:[e.result.body.humidity,"%"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-green-500",children:"\uD83D\uDD0B"}),r.jsx("span",{className:"font-medium",children:"バッテリー:"}),(0,r.jsxs)("span",{className:"font-bold text-green-600",children:[e.result.body.battery,"%"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCF1"}),r.jsx("span",{className:"font-medium",children:"バージョン:"}),r.jsx("span",{className:"text-gray-600",children:e.result.body.version})]})]}),r.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("span",{className:"font-medium text-gray-700",children:"\uD83D\uDCAD 快適度: "}),(()=>{let t=e.result.body.temperature,s=e.result.body.humidity;return t>=20&&t<=25&&s>=40&&s<=60?r.jsx("span",{className:"text-green-600 font-bold",children:"とても快適"}):t>=18&&t<=28&&s>=30&&s<=70?r.jsx("span",{className:"text-yellow-600 font-bold",children:"まあまあ快適"}):r.jsx("span",{className:"text-red-600 font-bold",children:"少し不快"})})()]})})]}),"MeterPlus"!==e.result.body.deviceType&&r.jsx("div",{className:"bg-gray-50 p-3 rounded border",children:(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"デバイス:"})," ",e.result.body.deviceType]}),void 0!==e.result.body.battery&&(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"バッテリー:"})," ",e.result.body.battery,"%"]}),e.result.body.version&&(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"バージョン:"})," ",e.result.body.version]})]})}),(0,r.jsxs)("details",{className:"mt-2",children:[r.jsx("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-700",children:"詳細データを表示"}),r.jsx("pre",{className:"text-xs bg-white p-2 rounded border overflow-auto mt-1",children:JSON.stringify(e.result,null,2)})]})]}),"send_command"===e.tool_name&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"⚡ コマンド実行結果"}),r.jsx("p",{className:"text-sm",children:"success"===e.status?"✅ 成功":"❌ 失敗"}),e.result&&r.jsx("pre",{className:"text-xs bg-white p-2 rounded border mt-2 overflow-auto",children:JSON.stringify(e.result,null,2)})]})]},t))})]}),"user"===e.role&&r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center",children:r.jsx(l,{className:"w-5 h-5 text-white"})})})]},t)),s&&(0,r.jsxs)("div",{className:"flex justify-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center",children:r.jsx(a,{className:"w-5 h-5 text-white animate-pulse"})})}),r.jsx("div",{className:"bg-white text-gray-900 border px-4 py-2 rounded-lg",children:r.jsx("p",{className:"text-sm text-gray-500",children:"考え中..."})})]}),r.jsx("div",{ref:m})]}),r.jsx("div",{className:"border-t bg-white p-4",children:(0,r.jsxs)("form",{onSubmit:u,className:"flex gap-2",children:[r.jsx("input",{type:"text",value:d,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u(e))},placeholder:"デバイスを操作するメッセージを入力...",disabled:s,className:o("flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent","bg-white text-gray-900 placeholder-gray-500 shadow-sm","hover:border-gray-400 focus:shadow-md transition-all duration-200",s&&"bg-gray-100 text-gray-500 cursor-not-allowed")}),(0,r.jsxs)("button",{type:"submit",disabled:s||!d.trim(),className:o("px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors shadow-sm","active:bg-blue-800 transform active:scale-95",(s||!d.trim())&&"bg-gray-300 text-gray-500 cursor-not-allowed hover:bg-gray-300 transform-none"),children:[s?r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx(i,{className:"w-5 h-5"}),r.jsx("span",{className:"sr-only",children:"送信"})]})]})})]})}let c=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"}))}),m=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"}))}),u=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"}))}),x=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"}))}),h=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z"}))}),p=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10.5h.375c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125H21M4.5 10.5h6.75V15H4.5v-4.5ZM3.75 18h15A2.25 2.25 0 0 0 21 15.75v-6a2.25 2.25 0 0 0-2.25-2.25h-15A2.25 2.25 0 0 0 1.5 9.75v6A2.25 2.25 0 0 0 3.75 18Z"}))}),f=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});function g({device:e,onCommand:t,isLoading:s=!1,loadingCommand:n}){let{id:a,type:l,name:i,room:d,capabilities:g,lastStatus:b,updatedAt:v}=e,j=b?.online!==!1,y=g.includes("turnOn")||g.includes("turnOff"),w=l.includes("Sensor")||l.includes("Meter"),N=(e,r)=>{s||t(a,e,r)};return(0,r.jsxs)("div",{className:o("bg-white rounded-lg border p-4 shadow-sm hover:shadow-md transition-shadow",!j&&"opacity-60"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-medium text-gray-900 text-sm",children:i}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx("span",{className:"text-xs text-gray-500",children:l}),d&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:"text-xs text-gray-300",children:"•"}),r.jsx("span",{className:"text-xs text-gray-500",children:d})]})]})]}),(0,r.jsxs)("div",{className:o("flex items-center gap-1",j?"text-green-500":"text-red-500"),children:[r.jsx(h,{className:"w-4 h-4"}),!j&&r.jsx("span",{"data-testid":"offline-indicator",className:"text-xs",children:"オフライン"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[y&&b?.power&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(u,{className:o("w-4 h-4","on"===b.power?"text-green-500":"text-gray-400")}),r.jsx("span",{className:o("text-sm font-medium","on"===b.power?"text-green-600":"text-gray-500"),children:"on"===b.power?"ON":"OFF"})]}),w&&b?(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[void 0!==b.temperature&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-blue-600",children:[r.jsx(c,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:[b.temperature,"\xb0C"]})]}),void 0!==b.humidity&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-green-600",children:[r.jsx(c,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:[b.humidity,"%"]})]}),void 0!==b.lightLevel&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-yellow-600",children:[r.jsx(m,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:[b.lightLevel," lux"]})]}),void 0!==b.co2&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-gray-600",children:[r.jsx(c,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:[b.co2," ppm"]})]})]}):null,b?.battery!==void 0&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[r.jsx(p,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:["バッテリー: ",b.battery,"%"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[r.jsx(f,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:["更新: ",(e=>{let t=Math.floor((new Date().getTime()-e.getTime())/6e4);if(t<1)return"今";if(t<60)return`${t}分前`;let s=Math.floor(t/60);return s<24?`${s}時間前`:`${Math.floor(s/24)}日前`})(v)]})]})]}),w||!y?null:(0,r.jsxs)("div",{className:"flex gap-2 mt-3",children:[g.includes("turnOn")&&(0,r.jsxs)("button",{onClick:()=>N("turnOn"),disabled:s,className:o("flex-1 flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium rounded-md transition-colors","bg-green-500 text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1",s&&"bg-gray-300 cursor-not-allowed hover:bg-gray-300"),children:[s&&"turnOn"===n?r.jsx("div",{"data-testid":"loading-spinner",className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):r.jsx(u,{className:"w-3 h-3"}),r.jsx("span",{children:"オン"})]}),g.includes("turnOff")&&(0,r.jsxs)("button",{onClick:()=>N("turnOff"),disabled:s,className:o("flex-1 flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium rounded-md transition-colors","bg-red-500 text-white hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1",s&&"bg-gray-300 cursor-not-allowed hover:bg-gray-300"),children:[s&&"turnOff"===n?r.jsx("div",{"data-testid":"loading-spinner",className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):r.jsx(u,{className:"w-3 h-3"}),r.jsx("span",{children:"オフ"})]}),g.includes("press")&&(0,r.jsxs)("button",{onClick:()=>N("press"),disabled:s,className:o("flex-1 flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium rounded-md transition-colors","bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",s&&"bg-gray-300 cursor-not-allowed hover:bg-gray-300"),children:[s&&"press"===n?r.jsx("div",{"data-testid":"loading-spinner",className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):r.jsx(x,{className:"w-3 h-3"}),r.jsx("span",{children:"プレス"})]})]})]})}let b=n.forwardRef(function({title:e,titleId:t,...s},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"}))}),v=[{id:"device-1",type:"Bot",name:"リビング スイッチ",room:"リビング",capabilities:["turnOn","turnOff","press"],lastStatus:{power:"off",battery:85,online:!0},updatedAt:new Date("2023-12-01T10:00:00Z")},{id:"sensor-1",type:"WoIOSensor",name:"リビング センサー",room:"リビング",capabilities:["getStatus"],lastStatus:{temperature:25.5,humidity:60,lightLevel:750,online:!0},updatedAt:new Date("2023-12-01T10:05:00Z")}],j=[{role:"assistant",content:"こんにちは！スマートホームの操作をお手伝いします。「エアコンをつけて」「照明を暗くして」などと話しかけてください。"}];function y(){let[e,t]=(0,n.useState)(j),[s,l]=(0,n.useState)([]),[i,o]=(0,n.useState)(!1),[c,m]=(0,n.useState)(!0),u=async()=>{try{m(!0);let e=await fetch("http://localhost:3001/api/switchbot/devices");if(!e.ok)throw Error(`API Error: ${e.status}`);let t=await e.json(),s=[];t.body?.deviceList&&t.body.deviceList.forEach(e=>{s.push({id:e.deviceId,type:e.deviceType,name:e.deviceName,room:x(e.deviceType,e.deviceName),capabilities:p(e.deviceType),lastStatus:{online:!0,deviceType:e.deviceType},updatedAt:new Date})}),t.body?.infraredRemoteList&&t.body.infraredRemoteList.forEach(e=>{s.push({id:e.deviceId,type:e.remoteType,name:e.deviceName,room:h(e.remoteType,e.deviceName),capabilities:f(e.remoteType),lastStatus:{online:!0,remoteType:e.remoteType},updatedAt:new Date})}),l(s)}catch(e){console.error("デバイス取得エラー:",e),l(v)}finally{m(!1)}},x=(e,t)=>{let s=t.toLowerCase();if(s.includes("リビング")||s.includes("living"))return"リビング";if(s.includes("寝室")||s.includes("bedroom"))return"寝室";if(s.includes("キッチン")||s.includes("kitchen"))return"キッチン";if(s.includes("玄関")||s.includes("entrance"))return"玄関";if(s.includes("洗面")||s.includes("bathroom"))return"洗面所";switch(e){case"Hub Mini":default:return"ホーム";case"MeterPlus":case"Bot":return"リビング"}},h=(e,t)=>{let s=t.toLowerCase();return s.includes("リビング")||s.includes("living")?"リビング":s.includes("寝室")||s.includes("bedroom")?"寝室":s.includes("キッチン")||s.includes("kitchen")?"キッチン":"リビング"},p=e=>{switch(e){case"Hub Mini":return["status"];case"MeterPlus":return["getStatus","temperature","humidity"];case"Bot":return["turnOn","turnOff","press"];default:return["getStatus"]}},f=e=>{switch(e){case"Air Conditioner":return["turnOn","turnOff","setTemperature","setMode"];case"TV":return["turnOn","turnOff","volumeUp","volumeDown","channelUp","channelDown"];case"Light":return["turnOn","turnOff","setBrightness"];default:return["turnOn","turnOff"]}},y=async s=>{let r={role:"user",content:s};t(e=>[...e,r]),o(!0);try{let s=await fetch("http://localhost:3001/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...e,r],enableTools:!0})});if(!s.ok)throw Error(`API Error: ${s.status}`);let n=await s.json(),a={role:"assistant",content:n.response.content||"",toolCalls:n.response.tool_calls?.map(e=>({id:e.id,type:"function",function:{name:e.function.name,arguments:e.function.arguments}}))||[],toolResults:n.toolResults||[]};t(e=>[...e,a])}catch(e){console.error("チャット送信エラー:",e),t(e=>[...e,{role:"assistant",content:"エラーが発生しました。もう一度お試しください。"}])}finally{o(!1)}},w=async(e,r,n)=>{console.log("デバイスコマンド:",{deviceId:e,command:r,parameter:n});try{let a=await fetch("http://localhost:3001/api/switchbot/command",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:e,command:r,parameter:n})}),l=await a.json(),i=s.find(t=>t.id===e),o={role:"assistant",content:a.ok?`✅ ${i?.name}の${r}コマンドを実行しました。`:`❌ ${i?.name}の${r}コマンドの実行に失敗しました。`,toolResults:a.ok?[{tool_name:"send_command",status:"success",result:l,timestamp:new Date().toISOString()}]:void 0};t(e=>[...e,o])}catch(l){console.error("デバイスコマンドエラー:",l);let n=s.find(t=>t.id===e),a={role:"assistant",content:`❌ ${n?.name}の${r}コマンドでエラーが発生しました。`};t(e=>[...e,a])}};return(0,r.jsxs)("div",{className:"h-screen max-h-screen flex flex-col",children:[r.jsx("header",{className:"bg-white shadow-sm border-b px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(b,{className:"w-6 h-6 text-primary-500"}),r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"RoomSense GPT"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(a,{className:"w-4 h-4"}),r.jsx("span",{children:"AI-Powered Smart Home Control"})]})]})}),(0,r.jsxs)("div",{className:"flex-1 flex min-h-0",children:[(0,r.jsxs)("aside",{className:"w-80 bg-white border-r p-4 overflow-y-auto scrollbar-thin",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"デバイス"}),r.jsx("div",{className:"flex gap-2",children:r.jsx("button",{onClick:u,disabled:c,className:"text-sm text-blue-600 hover:text-blue-800 disabled:opacity-50",children:c?"読込中...":"更新"})})]}),r.jsx("div",{className:"space-y-4",children:c?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.length>0?s.map(e=>r.jsx(g,{device:e,onCommand:w,isLoading:i},e.id)):(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{className:"text-sm",children:"デバイスが見つかりません"}),r.jsx("button",{onClick:u,className:"mt-2 text-blue-600 hover:text-blue-800 text-sm",children:"再試行"})]})})]}),r.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:r.jsx(d,{messages:e,onSendMessage:y,isLoading:i})})]})]})}},2251:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>l});var r=s(3270),n=s(5197),a=s.n(n);s(4146);let l={title:"RoomSense GPT - AI-Powered Smart Home Control",description:"Control your smart home devices with natural language using AI"};function i({children:e}){return r.jsx("html",{lang:"ja",children:r.jsx("body",{className:a().className,children:r.jsx("div",{className:"min-h-screen bg-gray-50",children:r.jsx("main",{className:"container mx-auto max-w-7xl px-4 py-6",children:e})})})})}},267:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(6808).createProxy)(String.raw`/Volumes/SSD2TB_DATA/src/llm-switchbot/apps/web/src/app/page.tsx#default`)},4146:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[842],()=>s(1651));module.exports=r})();